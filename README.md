# üéì –î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç ‚Äî DevOps

## üìå –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
–î–∏–ø–ª–æ–º–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø–æ—Å–≤—è—â—ë–Ω —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –ø–æ—Ä—Ç–∞–ª–∞ —Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º DevOps-–ø–æ–¥—Ö–æ–¥–∞.
–¶–µ–ª—å ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –¥–æ—Å—Ç–∞–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –º–æ–¥—É–ª—å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –∏ –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

- **VCS**: GitLab
- **CI/CD**: GitLab CI/CD + Gitlab Runner (Docker-in-Docker ‚Äî –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤, Shell ‚Äî –¥–ª—è –¥–µ–ø–ª–æ—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä)
- **IaC**: Terraform, Ansible
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker
- **–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ**: Python Flask, HTML + CSS + JS
- **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: Grafana, Mimir, Alloy
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: Grafana, Loki, Alloy
- **–í–µ–±-—Å–µ—Ä–≤–µ—Ä**: Nginx
- **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: Telegram Bot
- **–û–°**: Ubuntu 24.04.3 LTS
- **–Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è**: Bash, Python, YAML
- **–û–±–ª–∞—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞**: Yandex Cloud
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL
- **–ë—ç–∫–∞–ø—ã**: rsync, cp, tar, pg_dump

---

## üìã –°–ø–∏—Å–æ–∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –º–∞—à–∏–Ω

| VM          | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                | DNS / IP           | –û—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã |
|-------------|---------------------------|----------------------------|------------------|
| **vm-gitlab**   | GitLab CI/CD          | `gitlab.feebee.ru`         | GitLab CE, GitLab Runner |
| **vm-portal**   | –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Python Flask)    | `portal.feebee.ru`         | Python Flask, Nginx |
| **vm-grafana**  | –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ  | `grafana.feebee.ru`        | Grafana, Mimir, Loki, Alloy |
| **vm-jira**     | Jira + PostgreSQL         | `jira.feebee.ru` | Atlassian Jira DC, PostgreSQL |

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
1. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –æ–±–ª–∞—á–Ω—É—é –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å –ø–æ–º–æ—â—å—é Terraform (Yandex Cloud).
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–ª–µ–π–±—É–∫–∏ Ansible –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞ –≤—Å–µ –í–ú docker, nginx+certbot, alloy-agents.

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã —á–µ—Ä–µ–∑ Ansible:
* Jira Data Center + PostgreSQL (playbooks/jira.yml)
* GitLab CE (playbooks/gitlab.yml)
* Portal (Python Flask + Nginx) (playbooks/portal.yml)
* Grafana stack: Grafana, Mimir, Loki, Alloy (playbooks/grafana_stack.yml)
2. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–µ—Ä–≤–∏—á–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å–µ—Ä–≤–∏—Å–æ–≤ (—Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–∞—à–±–æ—Ä–¥—ã).
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Gitlab Runner –Ω–∞ vm-portal –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å Gitlab CI/CD.
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å/–Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –±—ç–∫–∞–ø—ã –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

### 3. –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
1. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π —Å –ø–æ–º–æ—â—å—é Terraform –∏ Ansible.
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ –≤—Å–µ –í–ú docker, nginx, certbot –∏ alloy-agent –¥–ª—è —Å–±–æ—Ä–∞ –º–µ—Ç—Ä–∏–∫.
3. –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (Gitlab, Jira, PostgreSQL, Grafana, Mimir, Loki, Alloy, Portal) –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö Docker.
3. –ú–æ–Ω–∏—Ç–æ—Ä–≥ –º–µ—Ç—Ä–∏–∫ –í–ú —Å –ø–æ–º–æ—â—å—é Mimir –∏ –ª–æ–≥–æ–≤ —Å –ø–æ–º–æ—â—å—é Loki, –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Grafana.
4. –ó–∞–ø—É—Å–∫ ansible-–ø–ª–ª–µ–π–±—É–∫–æ–≤ —á–µ—Ä–µ–∑ Gitlab CI/CD –ø–æ –∫–Ω–æ–ø–∫–∞–º —Å –ø–æ—Ä—Ç–∞–ª–∞.
5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Gitlab CI/CD –¥–ª—è –¥–µ–ø–ª–æ—è –ø–æ—Ä—Ç–∞–ª–∞ (2 gitlab-runner: DinD –∏ shell).
5. –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á –≤ Jira.
6. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ Telegram (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gitlab, Jira, Grafana).
7. –°–æ–∑–¥–∞–Ω–∏–µ –±–µ–∫–∞–ø–æ–≤ —Å –ø–æ–º–æ—â—å—é rsync, cp, tar, pg_dump.

### 4. –ë—ç–∫–∞–ø—ã
–ü—Ä–∏–º–µ—Ä –±—ç–∫–∞–ø–∞ Jira + PostgreSQL (–∑–∞–ø—É—Å–∫ –ø–æ cron)
```bash
# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –±–µ–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 5 –¥–Ω–µ–π)
find /opt/backup -mtime +5 -exec rm {} \;
find /opt/backup/export -mtime +5 -exec rm {} \;

# –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö –¥–∞–º–ø–æ–≤ PostgreSQL (—Å—Ç–∞—Ä—à–µ 5 –¥–Ω–µ–π)
find /var/pgsql/15/main/dump -mtime +5 -exec rm {} \;

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Jira
tar -czvf /opt/backup/jira_opt_install_$(date +%d-%m-%Y_%H-%M-%S).tar.gz /opt/atlassian/jira/

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ Jira
tar -czvf /opt/backup/jira_var_home_$(date +%d-%m-%Y_%H-%M-%S).tar.gz /var/atlassian/application-data/jira/

# –°–æ–∑–¥–∞–Ω–∏–µ –∞—Ä—Ö–∏–≤–∞ PostgreSQL –¥–∞–Ω–Ω—ã—Ö
tar -czvf /opt/backup/psql_$(date +%d-%m-%Y_%H-%M-%S).tar.gz /var/pgsql/

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞–º–ø–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö Jira
/bin/su - postgres -c "pg_dump -F c -f /opt/backup/psql_jiradb_dump_$(date +%d-%m-%Y_%H-%M-%S).dump jiradb"
```

–ü—Ä–∏–º–µ—Ä –±—ç–∫–∞–ø–∞ –ø–æ—Ä—Ç–∞–ª–∞ (–∑–∞–ø—É—Å–∫ –ø–æ –∫–Ω–æ–ø–∫–µ —á–µ—Ä–µ–∑ Gitlab CI/CD)

```bash
# –°–æ–∑–¥–∞–µ–º –∞—Ä—Ö–∏–≤
tar -czf /var/backups/portal/portal_backup_$(date +%Y%m%d_%H%M%S).tar.gz /opt/portal/

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º —Ö–æ—Å—Ç–æ–º
rsync -avz -e "ssh -p 22 -i /root/.ssh/id_ed25519 -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null" /var/backups/portal/ koshka14144@backup.feebee.ru:/opt/backup/portal_mirror/

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
find /var/backups/portal/ -name "portal_backup_*.tar.gz" -mtime +7 -delete
```

### 5. –°—Ö–µ–º–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
# [Miro](https://miro.com/app/board/uXjVJEFlUJg=/?share_link_id=46496434742)
# ![Diagram](diagram.png)